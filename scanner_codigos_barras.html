<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Contador de Códigos de Barras</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Librería ZXing -->
    <script src="https://unpkg.com/@zxing/library@latest"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 16px;
            background: #f2f2f2;
        }

        h1 {
            text-align: center;
        }

        video {
            width: 100%;
            max-height: 300px;
            background: black;
            border-radius: 8px;
        }

        #result {
            margin-top: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
        }

        button {
            width: 100%;
            margin-top: 12px;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #1976d2;
            color: white;
        }
    </style>
</head>
<body>

<h1>Escáner de Códigos</h1>

<video id="video" autoplay></video>

<div id="result">Esperando código…</div>

<button onclick="clearData()">Resetear contadores</button>

<script>
    const video = document.getElementById('video');
    const resultDiv = document.getElementById('result');

    const codeReader = new ZXing.BrowserBarcodeReader();

    let lastCode = null;
    let lastTime = 0;

    codeReader.decodeFromVideoDevice(null, video, (result, err) => {
        if (result) {
            const code = result.text;
            const now = Date.now();

            // Evitar contar el mismo código muchas veces seguidas
            if (code === lastCode && (now - lastTime) < 2000) {
                return;
            }

            lastCode = code;
            lastTime = now;

            let count = localStorage.getItem(code);
            count = count ? parseInt(count) + 1 : 1;

            localStorage.setItem(code, count);

            resultDiv.innerText =
                `Código: ${code}\nEscaneado: ${count} veces`;
        }
    });

    function clearData() {
        if (confirm("¿Seguro que quieres borrar todos los contadores?")) {
            localStorage.clear();
            resultDiv.innerText = "Datos borrados";
        }
    }
</script>

</body>
</html>
